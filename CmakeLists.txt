PROJECT(lua-zippp)
CMAKE_MINIMUM_REQUIRED(VERSION 3.24)

OPTION(LUA_ZIPPP_BUILD_SHARED "" ON)
IF(LUA_ZIPPP_BUILD_SHARED)
  SET(LUA_ZIPPP_LIBRARY_TYPE SHARED)
ENDIF()

# Basic configurations
SET(INSTALL_CMOD share/lua/cmod CACHE PATH "Directory to install Lua binary modules (configure lua via LUA_CPATH)")
# / configs

# Find libzippp
IF(NOT DEFINED LIBZIPPP_INCLUDE_DIR)
    FIND_LIBRARY(LIBZIPPP_LIBRARY NAMES zip)
    FIND_PATH(LIBZIPPP_INCLUDE_DIR libzippp.h
        PATH_SUFFIXES include/libzippp include
        )
    INCLUDE(FindPackageHandleStandardArgs)
    FIND_PACKAGE_HANDLE_STANDARD_ARGS(libzippp  DEFAULT_MSG  LIBZIPPP_LIBRARY LIBZIPPP_INCLUDE_DIR)
ENDIF()
# / Find libzippp

# Find lua
IF(NOT DEFINED LUA_INCLUDE_DIR)
  SET(LUA_INCLUDE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/third-party/bee.lua/3rd/lua")
ENDIF()
# / Find lua

# Define how to build zippp.so:
INCLUDE_DIRECTORIES(${LIBZIPPP_INCLUDE_DIR} ${LUA_INCLUDE_DIR})
ADD_LIBRARY(lua_zippp ${lua_zippp_LIBRARY_TYPE} lua_zippp.cpp lua_zippp.def)
SET_TARGET_PROPERTIES(lua_zippp PROPERTIES PREFIX "")
SET_TARGET_PROPERTIES(lua_zippp PROPERTIES OUTPUT_NAME zippp)
TARGET_LINK_LIBRARIES(lua_zippp ${LUA_LIBRARIES} ${LIBZIPPP_LIBRARY})  
# / build zippp.so